## Pnpm

### 节约磁盘空间并提升安装速度

![img](https://pnpm.io/zh/assets/images/cafs-illustration-7be6bd97e43ba11a031b099869321deb.jpg)

当使用 npm 或 Yarn 时，如果你有100个项目使用了某个依赖（dependency），就会有100份该依赖的副本保存在硬盘上。  而在使用 pnpm 时，依赖会被存储在内容可寻址的存储中，所以：

1. 如果你用到了某依赖项的不同版本，那么只会将有差异的文件添加到仓库。 例如，如果某个包有100个文件，而它的新版本只改变了其中1个文件。那么 `pnpm update` 时只会向存储中心额外添加1个新文件，而不会因为仅仅一个文件的改变复制整新版本包的内容。
2. 所有文件都会存储在硬盘上的某一位置。 当软件包被被安装时，包里的文件会硬链接到这一位置，而不会占用额外的磁盘空间。 这允许你跨项目地共享同一版本的依赖。

 因此，您在磁盘上节省了大量空间，这与项目和依赖项的数量成正比，并且安装速度要快得多！

### 创建非扁平化的 node_modules 文件夹

![img](https://pnpm.io/zh/assets/images/node-modules-structure-8ab301ddaed3b7530858b233f5b3be57.jpg)

使用 npm 或 Yarn Classic 安装依赖项时，所有包都被提升到模块目录的根目录。 因此，项目可以访问到未被添加进当前项目的依赖。

默认情况下，pnpm 使用软链的方式将项目的直接依赖添加进模块文件夹的根目录。 

### pnpm run

#### 与 `npm run` 的差异

默认情况下， pnpm 不会任意运行用户定义的 `pre` 和` post` 钩子脚本（例如 `prestart`）。 这种从 npm 继承的行为导致脚本是隐式的而不是显式的，从而混淆了执行流程。 它还会导致意外执行 `pnpm serve` 和 `pnpm preserve`。

如果出于某种原因您需要 npm 的前置、后置钩子脚本，可使用`enable-pre-post-scripts` 选项。

